<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Главная</title>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.2/angular.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!--<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>-->
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">-->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        var app = angular.module("Tensor", []);
        app.controller("TensorController", function ($scope, $http) {
            $scope.test = function (event) {
                debugger
            }

            function parseGetParams() {
                var $_GET = {};
                var __GET = window.location.search.substring(1).split("&");
                for (var i = 0; i < __GET.length; i++) {
                    var getVar = __GET[i].split("=");
                    $_GET[getVar[0]] = typeof (getVar[1]) == "undefined" ? "" : getVar[1];
                }
                return $_GET;
            }

            var args = parseGetParams();
            console.log(args)
            var all = {}
            window.getUser = function () {
                $http
                    .get('http://159.69.85.34:8080/getuser/' + args.name)
                    .success(function (result) {
                        all = result
                        $scope.surname = result.surname;
                        $scope.name = result.name[0].name;
                        $scope.photo = result.photo[0].photo;
                        console.log(result)
                    })
                    .error(function (error) {
                        <!--alert("Error"+error);-->
                        ;
                    });
            };
            window.getUser();
            var popular_data = {
                'Valentin': {
                    values: [29, 46, 6, 13, 6],
                    labels: ['Google Chrome', 'PyCharm', 'Telegram', 'Sublime Text 3'],
                    type: 'pie'
                },

                'Yuri': {
                    values: [67, 4, 29],
                    labels: ['Firefox', 'Telegram', 'ICQ'],
                    type: 'pie'
                },
                'Ivan': {
                    values: [28, 15, 44, 13],
                    labels: ['Google Chrome', 'Dota 2', 'PyCharm', 'Sublime Text 3'],
                    type: 'pie'
                },
                'Viktoria': {
                    values: [76, 15, 9],
                    labels: ['Safari', 'VLC', 'Deezer'],
                    type: 'pie'
                },
                'Denis': {
                    values: [13, 34, 15, 12, 26],
                    labels: ['Sublime Text 3', 'Google Chrome', 'Deezer', 'Pycharm', 'VLC'],
                    type: 'pie'
                }
            }

            window.popular = function () {
                var data = [];


                data = [popular_data['Denis']];


                var x1 = Math.random();
                var x2 = Math.random();
                var x3 = Math.random();
                var x4 = Math.random();
                var sum = x1+x2+x3+x4;

                data = [{
                    values: [x1/sum,x2/sum,x3/sum,x4/sum],
                    labels: popular_data['Valentin'].labels,
                    type: 'pie'
                }];


                var layout = {
                    height: '100%',
                    width: '100%'
                };
                document.getElementById('myDiv').innerHTML = '';
                Plotly.newPlot('myDiv', data, layout);
            };

            window.kpd = function () {
                var data = {};



                data = {
                    x: [1, 2, 4, 7],
                    y: [16, 5, 11, 9],
                    mode: 'lines',
                    name: 'Current'
                };

                // data = [{
                //     x: all['efs'].x,
                //     y: all['efs'].y,
                //     mode: 'scatter',
                //     name: 'Current'
                // }];

                var layout = {
                    height: '100%',
                    width: '100%',
                };
                document.getElementById('myDiv').innerHTML = '';
                Plotly.newPlot('myDiv', [data], layout);
            };


            window.screens = function () {
                var photos_to_show = '\n' +
                    '<div style="text-align: center; margin-top: -7%; margin-left: 27%">\n' +
                    '    <bodybutton>\n' +
                    '        <div class="container">\n' +
                    '            <div class="row">\n' +
                    '                <div class="col-sm-4">\n' +
                    '                    <button class="btn btn-lg btn-primary" onclick=screens()><b>Скрины</b></button>\n' +
                    '                </div>\n' +
                    '                <div class="col-sm-4">\n' +
                    '                    <button class="btn btn-lg btn-primary" onclick=web()><b>Веб-камера</b>\n' +
                    '                    </button>\n' +
                    '                </div>\n' +
                    '            </div>\n' +
                    '        </div>\n' +
                    '    </bodybutton>\n' +
                    '</div>';


                var photo_data = [];

                // photo_data = ['https://www.ya-roditel.ru/upload/medialibrary/15f/15f779e5b19fa041da904c9d30da5cfe.jpg',
                //     'https://www.pravmir.ru/wp-content/uploads/2018/10/Malchik-geroy-600x451.jpg']

                photo_data = all['screenshots'].screenshots;


                for (let i = 0; i < photo_data.length; i++) {
                    let tmp = "<img src='data:image/png;base64, " + photo_data[i].photo + "' id='base64image' width=\"100%\" height=\"100%\"/><h3> </h3>";
                    photos_to_show += tmp;
                }

                document.getElementById('myDiv').innerHTML = photos_to_show;
            };

            window.web = function () {
                var photos_to_show = '\n' +
                    '<div style="text-align: center; margin-top: -7%; margin-left: 27%">\n' +
                    '    <bodybutton>\n' +
                    '        <div class="container">\n' +
                    '            <div class="row">\n' +
                    '                <div class="col-sm-4">\n' +
                    '                    <button class="btn btn-lg btn-block btn-primary" onclick=screens()><b>Скрины</b></button>\n' +
                    '                </div>\n' +
                    '                <div class="col-sm-4">\n' +
                    '                    <button class="btn btn-lg btn-block btn-primary" onclick=web()><b>Веб-камера</b>\n' +
                    '                    </button>\n' +
                    '                </div>\n' +
                    '            </div>\n' +
                    '        </div>\n' +
                    '    </bodybutton>\n' +
                    '</div>';

                var photo_data = [];
                // photo_data = ['http://n1s1.hsmedia.ru/9e/52/70/9e52706dc8521c704c1ea4c44021b428/680x374_21_150322727fd8158d3110f155aa91e3bc@690x380_0xc0a8392b_11318839251497957095.jpeg']

                photo_data = all['photos'].photos;


                for (let i = 0; i < photo_data.length; i++) {
                    let tmp = "<img src='data:image/png;base64, " + photo_data[i].photo + "' id='base64image' ><h3> </h3>";
                    photos_to_show += tmp;
                }

                document.getElementById('myDiv').innerHTML = photos_to_show;
            };

            window.clicks = function () {


                var trace1 = {}
                // trace1 = {
                //     x: x1,
                //     type: "histogram",
                //     name: 'total'
                // };

                var trace2 = {}
                // trace2 = {
                //     x: x2,
                //     type: "histogram",
                //     name: 'rigth'
                //
                // };
                var trace3 = {}
                // trace3 = {
                //     x: x3,
                //     type: "histogram",
                //     name: 'left'
                // };

                var tmp = []
                for (let i = 1; i < all['clicks'].total.length; i++) {
                    tmp.push(all['clicks'].total[i].total)
                }
                trace1 = {
                    x: tmp,
                    type: "histogram",
                    name: 'total'
                };
                var tmp = []
                for (let i = 1; i < all['clicks'].right.length; i++) {
                    tmp.push(all['clicks'].right[i].rightt)
                }
                trace2 = {
                    x: tmp,
                    type: "histogram",
                    name: 'rigth'

                };
                var tmp = []
                for (let i = 1; i < all['clicks'].left.length; i++) {
                    tmp.push(all['clicks'].left[i].leftt)
                }
                trace3 = {
                    x: all['clicks'].left,
                    type: "histogram",
                    name: 'left'
                };

                var layout = {
                    height: '100%',
                    width: '100%',
                    barmode: "stack"
                };

                var data = [trace1, trace2, trace3];
                document.getElementById('myDiv').innerHTML = '';
                Plotly.newPlot("myDiv", data, layout);
            };

            window.timetable = function () {
                var timetable = "<img src='timetable.png' width='100%' height='100%'><h3> </h3>";
                document.getElementById('myDiv').innerHTML = timetable;
            }


            window.task = function () {
                var task_table = '<div style="width: 100%"></div><table class="table table-hover" ><tbody>';

                task_table += '<thead><tr><th>Задача</th><th>Статус</th></tr></thead>';

                var status = ['все норм', 'все кул', 'все плохо:('];
                var tasks = ['написать прогу', 'сделать коммит', 'сделать коммит в мастер'];

                // $http
                //     .get('http://0.0.0.0:8080/getuser/' + surname)
                //     .success(function (result) {
                //
                //         status = result[]
                //         tasks = result[];
                //
                //     })
                //     .error(function (error) {
                //         <!--alert("Error"+error);-->
                //         ;
                //     });

                for (let i = 0; i < status.length; i++) {
                    task_table += '<tr><td>' + tasks[i] + '</td><th scope="row">' + status[i] + '</th></tr>';
                }
                task_table += '</tbody></table></div>';

                document.getElementById('myDiv').innerHTML = task_table;

            };


            window.rating = function () {
                var data = {
                    x: ['1 июля', '2 июля', '3 июля', '4 июля', '5 июля', '6 июля', '7 июля', '8 июля', '9 июля', '10 июля'],
                    y: [16, 5, 11, 9, 23, 11, 32, 123, 1, 42],
                };

                // $http
                //     .get('http://0.0.0.0:8080/getuser/' + surname)
                //     .success(function (result) {
                //
                //         data = [{
                //              x: result['efs'].x,
                //              y: result['efs'].y,
                //         }];
                //     })
                //     .error(function (error) {
                //         <!--alert("Error"+error);-->
                //         ;
                //     });

                var turples = [];
                for (let i = 0; i < data.x.length; i++) {
                    turples[data.y[i]] = data.x[i];
                }

                function getSortedKeys(obj) {
                    var keys = [];
                    obj.forEach(function (item, index) {
                        keys.push(index);
                    });
                    return keys.sort(function compareNumbers(a, b) {
                        return b - a;
                    });
                }

                var keys = getSortedKeys(turples);

                var rating_table = '<div style="width: 100%"></div><table class="table table-hover" ><tbody>';
                rating_table += '<thead><tr><th>Дата</th><th>Эффективность</th></tr></thead>';

                var length = keys.length;
                if (length > 10) {
                    length = 10
                }

                for (let i = 0; i < length; i++) {
                    rating_table += '<tr><td>' + turples[keys[i]] + '</td><th scope="row">' + keys[i] + '</th></tr>';
                }
                rating_table += '</tbody></table></div>';
                console.log(rating_table);

                document.getElementById('myDiv').innerHTML = rating_table;

            }

            window.task();
        });
    </script>
</head>
<body ng-app="Tensor" ng-controller="TensorController as tc">

<div class="header jumbotron text-center" style="height: 30px;">
    <object class="logo" data="https://helpme1c.ru/wp-content/uploads/2015/02/logo_42.png" width="180" height="120"
            onclick="location.href='index.html'">
        Your browser does not support SVG
    </object>
    <h1><b>Big Brother</b></h1>
</div>

<div style="margin: 15%; margin-top: 0; margin-bottom: 0;">
    <div class="user-page">
        <div class="user-profile">
            <img id='base64image' src="data:image/png;base64, {{photo}}" width="400" height="300"/>
            <h3></h3>
            <div class="user-info">
                <table class="table" width="">
                    <tbody>
                    <tr>
                        <th scope="row">Имя:</th>
                        <td>{{name}}</td>
                    </tr>
                    <tr>
                        <th scope="row">Фамилия:</th>
                        <td>{{surname}}</td>
                    </tr>
                    <tr>
                        <th scope="row">Должность:</th>
                        <td>1С программист</td>
                    </tr>

                    </tbody>
                </table>
            </div>
        </div>
        <div class="user-data table col-sm-4">
            <thead></thead>
            <tbody>
            <bodybutton>
                <div class="container">
                    <div class="row">
                        <div class="col-sm-4">
                            <button style="font-size: 20px" name={{name}} class="btn btn-lg btn-block btn-primary"
                                    onclick=popular()>
                                <b>Программы</b></button>
                        </div>
                        <div class="col-sm-4">
                            <button style="font-size: 20px" name={{name}} class="btn btn-lg btn-block btn-primary"
                                    onclick=kpd()><b>Эффективность</b>
                            </button>
                        </div>
                        <div class="col-sm-4">
                            <button style="font-size: 20px" name={{name}} class="btn btn-lg btn-block btn-primary"
                                    onclick=screens()>
                                <b>Фотоотчет</b>
                            </button>
                        </div>
                        <div class="col-sm-4">
                            <button style="font-size: 20px" name={{name}} class="btn btn-lg btn-block btn-primary"
                                    onclick=clicks()>
                                <b>Клики</b>
                            </button>
                        </div>
                        <!--<div class="col-sm-4">-->
                        <!--<button style="font-size: 20px" alt={{name}} class="btn btn-lg btn-block btn-primary" onclick=rating(this)>-->
                        <!--<b>Рейтинг</b>-->
                        <!--</button>-->
                        <!--</div>-->
                        <div class="col-sm-4">
                            <button style="font-size: 20px" name={{name}} class="btn btn-lg btn-block btn-primary"
                                    onclick=timetable()>
                                <b>Расписание</b>
                            </button>
                        </div>
                        <div class="col-sm-4">
                            <button style="font-size: 20px" name={{name}} class="btn btn-lg btn-block btn-primary"
                                    onclick=task()>
                                <b>Задачи</b>
                            </button>
                        </div>
                    </div>
                </div>
            </bodybutton>
            <div id="myDiv" style="height:400px; overflow-y: scroll;">
                <!-- Plotly chart will be drawn inside this DIV -->
            </div>

            </tbody>
        </div>
    </div>
</div>
</div>


</body>
</html>