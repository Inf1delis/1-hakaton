<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Главная</title>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.2/angular.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!--<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>-->
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">-->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        var app = angular.module("Tensor", []);
        app.controller("TensorController", function ($scope, $http) {
            $scope.test = function (event) {
                debugger
            }

            function parseGetParams() {
               var $_GET = {};
               var __GET = window.location.search.substring(1).split("&");
               for(var i=0; i<__GET.length; i++) {
                  var getVar = __GET[i].split("=");
                  $_GET[getVar[0]] = typeof(getVar[1])=="undefined" ? "" : getVar[1];
               }
               return $_GET;
            }

            var args = parseGetParams();
            console.log(args)
            window.getUser = function () {
                $scope.surname = args.surname;
                $scope.name = args.name;
                $scope.photo = args.photo;
                // $http
                //     .get('http://0.0.0.0:8080/getuser/' + surname)
                //     .success(function (result) {
                //
                //         $scope.surname = result['surname'];
                //         $scope.name = result['name'];
                //         $scope.photo = 'data:image/png;base64, '+ result['photo']+ "'";
                //     })
                //     .error(function (error) {
                //         <!--alert("Error"+error);-->
                //         ;
                //     });
            };
            window.getUser()

            window.popular = function () {
                var data = [{
                    values: [30, 26, 44],
                    labels: ['Google Chrome', 'Dota 2', 'PyCharm'],
                    type: 'pie'
                }];

                // $http
                //     .get('http://0.0.0.0:8080/getuser/' + surname)
                //     .success(function (result) {
                //
                //         data = [{
                //              values: result['history'].ti,
                //              labels: result['history'].pr,
                //              type: 'pie'
                //         }];
                //     })
                //     .error(function (error) {
                //         <!--alert("Error"+error);-->
                //         ;
                //     });

                var layout = {
                    height: '100%',
                    width: '100%'
                };
                document.getElementById('myDiv').innerHTML = '';
                Plotly.newPlot('myDiv', data, layout);
            };

            window.kpd = function () {
                var data = {
                    x: [2, 3, 4, 5],
                    y: [16, 5, 11, 9],
                    mode: 'lines',
                    name: 'Current'
                };

                // $http
                //     .get('http://0.0.0.0:8080/getuser/' + surname)
                //     .success(function (result) {
                //
                //         data = [{
                //              x: result['efs'].x,
                //              y: result['efs'].y,
                //              mode: 'lines',
                //              name: 'Current'
                //         }];
                //     })
                //     .error(function (error) {
                //         <!--alert("Error"+error);-->
                //         ;
                //     });

                var layout = {
                    height: '100%',
                    width: '100%',
                };
                document.getElementById('myDiv').innerHTML = '';
                Plotly.newPlot('myDiv', [data], layout);
            };


            window.screens = function () {
                var photos_to_show = '\n' +
                    '<div style="text-align: center; margin-top: -7%; margin-left: 27%">\n' +
                    '    <bodybutton>\n' +
                    '        <div class="container">\n' +
                    '            <div class="row">\n' +
                    '                <div class="col-sm-4">\n' +
                    '                    <button class="btn btn-lg btn-primary" onclick=screens()><b>Скрины</b></button>\n' +
                    '                </div>\n' +
                    '                <div class="col-sm-4">\n' +
                    '                    <button class="btn btn-lg btn-primary" onclick=web()><b>Веб-камера</b>\n' +
                    '                    </button>\n' +
                    '                </div>\n' +
                    '            </div>\n' +
                    '        </div>\n' +
                    '    </bodybutton>\n' +
                    '</div>';

                var photo = "<img src='";

                var photo_data = ['https://www.ya-roditel.ru/upload/medialibrary/15f/15f779e5b19fa041da904c9d30da5cfe.jpg',
                    'https://www.pravmir.ru/wp-content/uploads/2018/10/Malchik-geroy-600x451.jpg']

                // $http
                //     .get('http://0.0.0.0:8080/getuser/' + surname)
                //     .success(function (result) {
                //
                //         photo_data = result['screenshots']
                //     })
                //     .error(function (error) {
                //         <!--alert("Error"+error);-->
                //         ;
                //     });


                for (let i = 0; i < photo_data.length; i++) {
                    let tmp = photo + photo_data[i] + "' width=\"100%\" height=\"100%\"/><h3> </h3>";
                    photos_to_show += tmp;
                }

                document.getElementById('myDiv').innerHTML = photos_to_show;
            };

            window.web = function () {
                var photos_to_show = '\n' +
                    '<div style="text-align: center; margin-top: -7%; margin-left: 27%">\n' +
                    '    <bodybutton>\n' +
                    '        <div class="container">\n' +
                    '            <div class="row">\n' +
                    '                <div class="col-sm-4">\n' +
                    '                    <button class="btn btn-lg btn-block btn-primary" onclick=screens()><b>Скрины</b></button>\n' +
                    '                </div>\n' +
                    '                <div class="col-sm-4">\n' +
                    '                    <button class="btn btn-lg btn-block btn-primary" onclick=web()><b>Веб-камера</b>\n' +
                    '                    </button>\n' +
                    '                </div>\n' +
                    '            </div>\n' +
                    '        </div>\n' +
                    '    </bodybutton>\n' +
                    '</div>';

                var photo = "<img src='";
                var photo_data = ['http://n1s1.hsmedia.ru/9e/52/70/9e52706dc8521c704c1ea4c44021b428/680x374_21_150322727fd8158d3110f155aa91e3bc@690x380_0xc0a8392b_11318839251497957095.jpeg']

                // $http
                //     .get('http://0.0.0.0:8080/getuser/' + surname)
                //     .success(function (result) {
                //
                //         photo_data = result['photos']
                //     })
                //     .error(function (error) {
                //         <!--alert("Error"+error);-->
                //         ;
                //     });

                for (let i = 0; i < photo_data.length; i++) {
                    let tmp = photo + photo_data[i] + "' ><h3> </h3>";
                    photos_to_show += tmp;
                }

                document.getElementById('myDiv').innerHTML = photos_to_show;
            };

            window.clicks = function () {
                var x1 = [];
                var x2 = [];
                var x3 = [];
                for (var i = 0; i < 500; i++) {
                    x1[i] = Math.random();
                    x2[i] = Math.random();
                    x3[i] = Math.random();
                }

                var trace1 = {
                    x: x1,
                    type: "histogram",
                    name: 'total'
                };
                var trace2 = {
                    x: x2,
                    type: "histogram",
                    name: 'rigth'

                };
                var trace3 = {
                    x: x3,
                    type: "histogram",
                    name: 'left'
                };

                // $http
                //     .get('http://0.0.0.0:8080/getuser/' + surname)
                //     .success(function (result) {
                //
                //         trace1 = {
                //             x: result['total'],
                //             type: "histogram",
                //             name: 'total'
                //         };
                //         trace2 = {
                //             x: result['rigth'],
                //             type: "histogram",
                //             name: 'rigth'
                //
                //         };
                //         trace3 = {
                //             x: result['left'],
                //             type: "histogram",
                //             name: 'left'
                //         };
                //
                //
                //     })
                //     .error(function (error) {
                //         <!--alert("Error"+error);-->
                //         ;
                //     });

                var layout = {
                    height: '100%',
                    width: '100%',
                    barmode: "stack"
                };

                var data = [trace1, trace2, trace3];
                document.getElementById('myDiv').innerHTML = '';
                Plotly.newPlot("myDiv", data, layout);
            };


            window.task = function () {
                var task_table = '<div style="width: 100%"></div><table class="table table-hover" ><tbody>';

                task_table += '<thead><tr><th>Задача</th><th>Статус</th></tr></thead>';

                var status = ['все норм', 'все кул', 'все плохо:('];
                var tasks = ['написать прогу', 'сделать коммит', 'сделать коммит в мастер'];

                // $http
                //     .get('http://0.0.0.0:8080/getuser/' + surname)
                //     .success(function (result) {
                //
                //         status = result[]
                //         tasks = result[];
                //
                //     })
                //     .error(function (error) {
                //         <!--alert("Error"+error);-->
                //         ;
                //     });

                for (let i = 0; i < status.length; i++) {
                    task_table += '<tr><td>' + tasks[i] + '</td><th scope="row">' + status[i] + '</th></tr>';
                }
                task_table += '</tbody></table></div>';

                document.getElementById('myDiv').innerHTML = task_table;

            };


            window.rating = function () {
                var data = {
                    x: ['1 июля', '2 июля', '3 июля', '4 июля', '5 июля', '6 июля', '7 июля', '8 июля', '9 июля', '10 июля'],
                    y: [16, 5, 11, 9, 23, 11, 32, 123, 1, 42],
                };

                // $http
                //     .get('http://0.0.0.0:8080/getuser/' + surname)
                //     .success(function (result) {
                //
                //         data = [{
                //              x: result['efs'].x,
                //              y: result['efs'].y,
                //         }];
                //     })
                //     .error(function (error) {
                //         <!--alert("Error"+error);-->
                //         ;
                //     });

                var turples = [];
                for (let i = 0; i < data.x.length; i++) {
                    turples[data.y[i]] = data.x[i];
                }

                function getSortedKeys(obj) {
                    var keys = [];
                    obj.forEach(function (item, index) {
                        keys.push(index);
                    });
                    return keys.sort(function compareNumbers(a, b) {
                        return b - a;
                    });
                }

                var keys = getSortedKeys(turples);

                var rating_table = '<div style="width: 100%"></div><table class="table table-hover" ><tbody>';
                rating_table += '<thead><tr><th>Дата</th><th>Эффективность</th></tr></thead>';

                var length = keys.length;
                if (length > 10) {
                    length = 10
                }

                for (let i = 0; i < length; i++) {
                    rating_table += '<tr><td>' + turples[keys[i]] + '</td><th scope="row">' + keys[i] + '</th></tr>';
                }
                rating_table += '</tbody></table></div>';
                console.log(rating_table);

                document.getElementById('myDiv').innerHTML = rating_table;

            }

            window.popular();
        });
    </script>
</head>
<body ng-app="Tensor" ng-controller="TensorController as tc">

<div class="header jumbotron text-center" style="height: 30px;">
    <object class="logo" data="https://helpme1c.ru/wp-content/uploads/2015/02/logo_42.png" width="180" height="120"
            onclick="location.href='index.html'">
        Your browser does not support SVG
    </object>
    <h1><b>Big Brother</b></h1>
</div>

<div style="margin: 15%; margin-top: 0; margin-bottom: 0;">
    <div class="user-page">
        <div class="user-profile">
            <img src={{photo}} width="400" height="300"/>
            <h3></h3>
            <div class="user-info">
                <table class="table" width="">
                    <tbody>
                    <tr>
                        <th scope="row">Имя:</th>
                        <td>{{name}}</td>
                    </tr>
                    <tr>
                        <th scope="row">Фамилия:</th>
                        <td>{{surname}}</td>
                    </tr>
                    <tr>
                        <th scope="row">Должность:</th>
                        <td>1С программист</td>
                    </tr>
                    <tr>
                        <th scope="row">Возраст</th>
                        <td>12</td>
                    </tr>

                    </tbody>
                </table>
            </div>
        </div>
        <div class="user-data table col-sm-4">
            <thead></thead>
            <tbody>
            <bodybutton>
                <div class="container">
                    <div class="row">
                        <div class="col-sm-4">
                            <button style="font-size: 20px" alt={{name}} class="btn btn-lg btn-block btn-primary" onclick=popular(this)>
                                <b>Программы</b></button>
                        </div>
                        <div class="col-sm-4">
                            <button style="font-size: 20px" alt={{name}} class="btn btn-lg btn-block btn-primary" onclick=kpd(this)><b>Эффективность</b>
                            </button>
                        </div>
                        <div class="col-sm-4">
                            <button style="font-size: 20px" alt={{name}} class="btn btn-lg btn-block btn-primary" onclick=screens(this)>
                                <b>Фотоотчет</b>
                            </button>
                        </div>
                        <div class="col-sm-4">
                            <button style="font-size: 20px" alt={{name}} class="btn btn-lg btn-block btn-primary" onclick=clicks(this)>
                                <b>Клики</b>
                            </button>
                        </div>
                        <div class="col-sm-4">
                            <button style="font-size: 20px" alt={{name}} class="btn btn-lg btn-block btn-primary" onclick=rating(this)>
                                <b>Рейтинг</b>
                            </button>
                        </div>
                        <div class="col-sm-4">
                            <button style="font-size: 20px" alt={{name}} class="btn btn-lg btn-block btn-primary" onclick=task(this)>
                                <b>Задачи</b>
                            </button>
                        </div>
                    </div>
                </div>
            </bodybutton>
            <div id="myDiv" style="height:400px; overflow-y: scroll;">
                <!-- Plotly chart will be drawn inside this DIV -->
            </div>

            </tbody>
        </div>
    </div>
</div>
</div>


</body>
</html>